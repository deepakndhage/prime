<!doctype html>
<html>
<head>
<title>Test Project</title>
<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<script src="bower_components/webcomponentsjs/webcomponents.js"></script>
<link rel="import" href="bower_components/polymer/polymer.html">
	<link rel="import" href="bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="bower_components/paper-toast/paper-toast.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">
	<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/paper-menu/paper-menu.html">
<link rel="import" href="bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="bower_components/paper-styles/paper-styles.html">	
	<link rel="import" href="bower_components/paper-slider/paper-slider.html">
	<link rel="import" href="bower_components/paper-styles/color.html">
	<!--<link rel="import" href="bower_components/core-tooltip/core-tooltip.html">
	<link rel="import" href="bower_components/core-icon-button/core-icon-button.html">
	<link rel="import" href="bower_components/core-toolbar/core-toolbar.html">

	<link rel="import" href="bower_components/iron-icons/iron-icons.html">
  	<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
  	<link rel="import" href="bower_components/paper-toolbar/paper-toolbar.html">	-->

<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="ControllerPlugin.js"></script>
	 	  <script type="text/javascript" src="bluetoothSerial.js"></script>
<style>
html, body {
height: 100%;
margin: 0;
font-family: 'Roboto', 'Noto', sans-serif;
font-size: 14px;
padding: 2%;
}
body {
font-family: sans-serif;
}


.header.paper-card {
position: relative;
border-top-left-radius: inherit;
border-top-right-radius: inherit;
overflow: hidden;
}
.header.paper-card img.paper-card {
width: 100%;
pointer-events: none;
}
paper-card .card-content {
padding: 16px;
position: relative;
}
paper-card .card-actions {
border-top: 1px solid #e8e8e8;
padding: 5px 16px;
position: relative;
}
paper-card:not([style-scope]):not(.style-scope) {
width: 100%;
margin-bottom: 16px;
}
paper-card.paper-card-1[elevation="1"] {
box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
}
paper-card {
display: inline-block;
position: relative;
box-sizing: border-box;
background: #fff;
border-radius: 2px;
}
paper-button {
display: inline-block;
position: relative;
box-sizing: border-box;
min-width: 5.14em;
margin: 0 0.29em;
background: transparent;
text-align: center;
font: inherit;
text-transform: uppercase;
outline-width: 0;
border-radius: 3px;
-moz-user-select: none;
-ms-user-select: none;
-webkit-user-select: none;
user-select: none;
cursor: pointer;
z-index: 0;
padding: 0.7em 0.57em;
}
.header.paper-card .title-text.paper-card {
padding: 16px;
font-size: 24px;
font-weight: bold;
}
text.over-image.paper-card {
position: absolute;
bottom: 0px;
}
.paper-card-1 .header.paper-card .title-text.paper-card {
color: #FFFFFF;
}
.header.paper-card .title-text.over-image.paper-card {
position: absolute;
bottom: 0px;
}
paper-icon-item.paper-icon-item-0 {
display: -ms-flexbox;
display: -webkit-flex;
display: flex;
-ms-flex-direction: row;
-webkit-flex-direction: row;
flex-direction: row;
-ms-flex-align: center;
-webkit-align-items: center;
align-items: center;
font-family: 'Roboto', 'Noto', sans-serif;
-webkit-font-smoothing: antialiased;
font-size: 16px;
font-weight: 400;
line-height: 24px;
}
paper-icon-item.paper-icon-item-0 {
min-height: 48px;
}
paper-icon-item {
display: block;
padding: 0px 16px;
}
.paper-icon-item-0 .content-icon.paper-icon-item {
width: 56px;
}
.avatar:not([style-scope]):not(.style-scope) {
display: inline-block;
width: 40px;
height: 40px;
border-radius: 50%;
overflow: hidden;

}
.red:not([style-scope]):not(.style-scope) {
background-color: #e57373;
}
.blue:not([style-scope]):not(.style-scope) {
background-color: #4fc3f7;
}
.green:not([style-scope]):not(.style-scope) {
background-color: #4caf50;
}
.gray:not([style-scope]):not(.style-scope) {
background-color: #9e9e9e;
}
#core_tooltip {
left: 1110px;
top: 580px;
position: absolute;
  }
  #core_item {
left: 1120px;
top: 400px;
position: absolute;
  }
paper-toolbar {
display: block;
position: relative;
box-sizing: border-box;
-moz-box-sizing: border-box;
height: 64px;
}
paper-toolbar.paper-toolbar-0 {
background: #3f51b5;
color: #ffffff;
}

paper-slider:not([style-scope]):not(.style-scope) {
width: 80%;
}
.doneGreen{
background: #4caf50 none repeat scroll 0 0;
color: #ffffff;
}
</style>

  </head>
<body unresolved>
<paper-toolbar>
  <div class="title">Prime Home Control <span id="titleState"></span></div>
<paper-fab mini icon="favorite" id="fav" style="top:10px; right:20px; position: absolute;"></paper-fab>
<paper-fab mini icon="star" id="star" style="top:10px;right:70px; position: absolute;"></paper-fab>
</paper-toolbar>
	<paper-card heading="Titles AND images!" class="pink x-scope paper-card-1" image="http://placehold.it/350x150" aria-label="Titles AND images!" elevation="1">


<div class="header style-scope paper-card">
  <img class="style-scope paper-card" src="img/leaving_350X150.jpg">
  <div class="title-text over-image style-scope paper-card" id="lrl">Leaving Room <span id="lrlSpan"></span></div>
</div>


  <div class="card-content">
  <paper-icon-item role="option" tabindex="0" aria-disabled="false" class="x-scope paper-icon-item-0" id="lrcl1">



<div id="contentIcon" class="content-icon layout horizontal center style-scope paper-icon-item">
  <paper-fab mini class="avatar green" icon="done" id="pf1"></paper-fab>
</div>

   Lights
 	<paper-slider id="ps1" value="20" max="100" editable pin></paper-slider>
	</paper-icon-item>
<paper-icon-item role="option" tabindex="0" aria-disabled="false" class="x-scope paper-icon-item-0" id="lral1">



<div id="contentIcon" class="content-icon layout horizontal center style-scope paper-icon-item">
  <paper-fab mini class="avatar red" icon="done" id="pf2">
</div>

   Ambient LED
	   
</paper-icon-item>
  </div>
  <div class="card-actions">
<paper-button role="button" tabindex="0" animated="" aria-disabled="false" class="x-scope paper-button-0" id="lrallon">


ON
  </paper-button>
<paper-button role="button" tabindex="0" animated="" aria-disabled="false" class="x-scope paper-button-0" id="lralloff">


OFF
  </paper-button>
  </div>

  </paper-card>
<paper-card heading="Titles AND images!" class="pink x-scope paper-card-1" image="http://placehold.it/350x150" aria-label="Titles AND images!" elevation="1">


<div class="header style-scope paper-card">
  <img class="style-scope paper-card" src="img/Kitchen_350X150.jpg">
	<div class="title-text over-image style-scope paper-card">Kitchen</div>
</div>


  <div class="card-content">
	<paper-icon-item role="option" tabindex="0" aria-disabled="false" class="x-scope paper-icon-item-0" id="kcl1">



<div id="contentIcon" class="content-icon layout horizontal center style-scope paper-icon-item">
  <paper-fab mini class="avatar green" icon="done" id="pf1"></paper-fab>
</div>

   Lights
   <paper-slider id="ps2" value="20" max="100" editable pin></paper-slider>
  </paper-icon-item>
<paper-icon-item role="option" tabindex="0" aria-disabled="false" class="x-scope paper-icon-item-0" id="kal1">



<div id="contentIcon" class="content-icon layout horizontal center style-scope paper-icon-item">
  <paper-fab mini class="avatar red" icon="done" id="pf2">
</div>

   Ambient LED

  </paper-icon-item>
  </div>
  <div class="card-actions">
<paper-button role="button" tabindex="0" animated="" aria-disabled="false" class="x-scope paper-button-0" id="kallon">


ON
  </paper-button>
<paper-button role="button" tabindex="0" animated="" aria-disabled="false" class="x-scope paper-button-0" id="kalloff">


OFF
  </paper-button>
  </div>

  </paper-card>
<paper-card heading="Titles AND images!" class="pink x-scope paper-card-1" image="http://placehold.it/350x150" aria-label="Titles AND images!" elevation="1">


<div class="header style-scope paper-card">
  <img class="style-scope paper-card" src="img/children_350X150.jpg">
  <div class="title-text over-image style-scope paper-card">Bedroom 1</div>
</div>


  <div class="card-content">
	<paper-icon-item role="option" tabindex="0" aria-disabled="false" class="x-scope paper-icon-item-0"  id="b1cl1">



<div id="contentIcon" class="content-icon layout horizontal center style-scope paper-icon-item">
  <paper-fab mini class="avatar green" icon="done" id="pf1"></paper-fab>
</div>

   Lights
   <paper-slider id="ps3" value="50" max="100" editable pin></paper-slider>
  </paper-icon-item>
<paper-icon-item role="option" tabindex="0" aria-disabled="false" class="x-scope paper-icon-item-0" id="b1al1">



<div id="contentIcon" class="content-icon layout horizontal center style-scope paper-icon-item">
  <paper-fab mini class="avatar red" icon="done" id="pf2">
</div>

   Ambient LED

  </paper-icon-item>
  </div>
  <div class="card-actions">
<paper-button role="button" tabindex="0" animated="" aria-disabled="false" class="x-scope paper-button-0" id="b1allon">


ON
  </paper-button>
<paper-button role="button" tabindex="0" animated="" aria-disabled="false" class="x-scope paper-button-0" id="b1alloff">


OFF
  </paper-button>
  </div>

  </paper-card>
<paper-card heading="Titles AND images!" class="pink x-scope paper-card-1" image="http://placehold.it/350x150" aria-label="Titles AND images!" elevation="1">


<div class="header style-scope paper-card">
  <img class="style-scope paper-card" src="img/children_350X150.jpg">
  <div class="title-text over-image style-scope paper-card">Bedroom 2</div>
</div>


  <div class="card-content">
	<paper-icon-item role="option" tabindex="0" aria-disabled="false" class="x-scope paper-icon-item-0"  id="b2cl1">



<div id="contentIcon" class="content-icon layout horizontal center style-scope paper-icon-item">
  <paper-fab mini class="avatar green" icon="done" id="pf1"></paper-fab>
</div>

   Lights
   <paper-slider id="ps4" value="50" max="100" editable pin></paper-slider>
  </paper-icon-item>
<paper-icon-item role="option" tabindex="0" aria-disabled="false" class="x-scope paper-icon-item-0" id="b2al1">



<div id="contentIcon" class="content-icon layout horizontal center style-scope paper-icon-item">
  <paper-fab mini class="avatar red" icon="done" id="pf2">
</div>

   Ambient LED

  </paper-icon-item>
  </div>
  <div class="card-actions">
<paper-button role="button" tabindex="0" animated="" aria-disabled="false" class="x-scope paper-button-0" id="b2allon">


ON
  </paper-button>
<paper-button role="button" tabindex="0" animated="" aria-disabled="false" class="x-scope paper-button-0" id="b2alloff">


OFF
  </paper-button>
  </div>

  </paper-card>
<script type= "application/javascript" src="js/jquery.min.js"></script>

<script  type= "application/javascript">
 
$(function() {
alert("0");
document.addEventListener("deviceready", onDeviceReady, false);
});

function onDeviceReady() {
	readCurrentState();
var counter = 0;
		var sent = 0;
		if(!cordova.plugins.backgroundMode.isActive()){
		 	cordova.plugins.backgroundMode.setDefaults({ text:'Home Automation System'});
		 	cordova.plugins.backgroundMode.enable();
		 }
		window.powerManagement.dim(function() {
			//lock acquired
		}, function() {
			// falied to acquire lock
		});
		window.powerManagement.setReleaseOnPause(false, function() {
			console.log('setReleaseOnPause successfully');
		}, function() {
			console.log('Failed to set');
		}); 
		setInterval(function(){ bluetoothSerial.isEnabled(
		listPorts,
		notEnabled
	);  }, 4000);
		function listPorts() {
		
		// connect to device
		isBTConnected();

	}
		function notEnabled() {
	cordova.plugins.BluetoothStatus.enableBT();
	}
		function isBTConnected(){
			bluetoothSerial.isConnected(
					function() {
						//$("#logo-img").attr('src','./images/logo_white.png');   
					},
					function() {
						sent = 0;
						// connect to device if not already connected
						if(counter==0){
	  	  					connectToBT();
	  	  				}
			
					}
				);
				// on connect send the current state to BT
				bluetoothSerial.isConnected(
					function() {
				
				// on connect send the current state to BT
						
						if(sent!=1){   
							sent++;   		
							//sendCurrentStateToBackend();
							readCurrentState();
		}
		else{
		}
	},
				function() {
					 
		 		//$("#error").html($("#error").html()+" not sending current state - ");
				}
				);
		}
		function connectToBT(){
		counter=1;
		bluetoothSerial.connect("20:14:12:03:13:38", connectSuccess, onConnectError);
 	}
		function onConnectError(){
		  	bluetoothSerial.disconnect(disconnectDone, disconnectNotDone);
			cordova.plugins.BluetoothStatus.disableBT();
			$('#titleState').html("Not Connected");
			counter=0;
	 	}
		function disconnectDone(){
  	
 		}
 	  	function disconnectNotDone(error){
  
 		}
		function connectSuccess(){
			$('#titleState').html("Connected");
			bluetoothSerial.subscribe('!', readData, failedToRead);
		}
		function readData(inputData){
		
		}
		function failedToRead(){
		   
		}
		
		
		$('#lrl').click(
		
	function(){
		sendStateToBT(1,20);sleep(1000);
		sendStateToBT(2,20);sleep(1000);
		sendStateToBT(3,30);sleep(1000);
		sendStateToBT(4,40);sleep(1000);
		sendStateToBT(5,50);sleep(1000);
		sendStateToBT(6,60);sleep(1000);
		sendStateToBT(1,0);sleep(1000);
		sendStateToBT(2,0);sleep(1000);
		sendStateToBT(3,0);sleep(1000);
		sendStateToBT(4,0);sleep(1000);
		sendStateToBT(5,0);sleep(1000);
		sendStateToBT(6,0);sleep(1000);
 }
	
 );
document.querySelector('#lrcl1 #pf1').addEventListener('click', function(e) {
	//alert('Leaving room Ceiling lights - On-Off ');
	if($('#lrcl1 #pf1').hasClass("green")){
		sendStateToBT(1,0);
		$('#lrcl1 #pf1').removeClass("green");
		$('#lrcl1 #pf1').addClass("gray");
		$("#ps1").attr("value", "0");
	}
	else{
		sendStateToBT(1,100);
		$('#lrcl1 #pf1').removeClass("gray");
		$('#lrcl1 #pf1').addClass("green");
		$("#ps1").attr("value", "100");
	}

});
document.querySelector('#lral1 #pf2').addEventListener('click', function(e) {
	//alert('Leaving room Ambient LED - On-Off');
	if($('#lral1 #pf2').hasClass("red")){
		sendStateToBT(2,0);
		$('#lral1 #pf2').removeClass("red");
		$('#lral1 #pf2').addClass("gray");
	}
	else{
		sendStateToBT(2,100);
		$('#lral1 #pf2').removeClass("gray");
		$('#lral1 #pf2').addClass("red");
	}
});
document.querySelector('#lrallon').addEventListener('click', function(e) {
	//alert('Leaving room all on');
	sendStateToBT(1,100);
	$('#lrcl1 #pf1').removeClass("gray");
	$('#lrcl1 #pf1').addClass("green");
	$("#ps1").attr("value", 100);
	sleep(500);
	sendStateToBT(2,100);
	$('#lral1 #pf2').removeClass("gray");
	$('#lral1 #pf2').addClass("red");
 });
document.querySelector('#lralloff').addEventListener('click', function(e) {
	//alert('Leaving room all off');
	sendStateToBT(1,0);
	$('#lrcl1 #pf1').removeClass("green");
	$('#lrcl1 #pf1').addClass("gray");
	$("#ps1").attr("value", 0);
	sleep(500);
	sendStateToBT(2,0);
	$('#lral1 #pf2').removeClass("red");
  	$('#lral1 #pf2').addClass("gray");
 });
document.querySelector('#kcl1 #pf1').addEventListener('click', function(e) {
	//alert('Kitchen Ceiling lights - On-Off');
	if($('#kcl1 #pf1').hasClass("green")){
		sendStateToBT(3,0);
		$('#kcl1 #pf1').removeClass("green");
		$('#kcl1 #pf1').addClass("gray");
		$("#ps2").attr("value", "0");
	}
	else{
		sendStateToBT(3,100);
		$('#kcl1 #pf1').removeClass("gray");
		$('#kcl1 #pf1').addClass("green");
		$("#ps2").attr("value", "100");
	}
 });
document.querySelector('#kal1 #pf2').addEventListener('click', function(e) {
	//alert('Kitchen Ambient LED - On-Off');
	if($('#kal1 #pf2').hasClass("red")){
		sendStateToBT(4,0);
		$('#kal1 #pf2').removeClass("red");
		$('#kal1 #pf2').addClass("gray");
	}
	else{
		sendStateToBT(4,100);
		$('#kal1 #pf2').removeClass("gray");
		$('#kal1 #pf2').addClass("red");
	}
 });
document.querySelector('#kallon').addEventListener('click', function(e) {
	//alert('Kitchen all on');
	sendStateToBT(3,100);
	$('#kcl1 #pf1').removeClass("gray");
	$('#kcl1 #pf1').addClass("green");
	$("#ps2").attr("value", 100);
	sleep(500);
	sendStateToBT(4,100);
	$('#kal1 #pf2').removeClass("gray");
	$('#kal1 #pf2').addClass("red");
 });
document.querySelector('#kalloff').addEventListener('click', function(e) {
	//alert('Kitchen all off');
	sendStateToBT(3,0);
	$('#kcl1 #pf1').removeClass("green");
	$('#kcl1 #pf1').addClass("gray");
	$("#ps2").attr("value", 0);
	sleep(500);
	sendStateToBT(4,0);
	$('#kal1 #pf2').removeClass("red");
	$('#kal1 #pf2').addClass("gray");
 });
document.querySelector('#b1cl1 #pf1').addEventListener('click', function(e) {
	//alert('Bedroom 1 Ceiling lights - On-Off');
	if($('#b1cl1 #pf1').hasClass("green")){
		sendStateToBT(5,0);
		$('#b1cl1 #pf1').removeClass("green");
		$('#b1cl1 #pf1').addClass("gray");
		$("#ps3").attr("value", "0");
	}
	else{
		sendStateToBT(5,100);
		$('#b1cl1 #pf1').removeClass("gray");
		$('#b1cl1 #pf1').addClass("green");
		$("#ps3").attr("value", "100");
	}
 });
document.querySelector('#b1al1 #pf2').addEventListener('click', function(e) {
	//alert('Bedroom 1 Ambient LED - On-Off');
	if($('#b1al1 #pf2').hasClass("red")){
		sendStateToBT(6,0);
		$('#b1al1 #pf2').removeClass("red");
		$('#b1al1 #pf2').addClass("gray");
	}
	else{
		sendStateToBT(6,100);
		$('#b1al1 #pf2').removeClass("gray");
		$('#b1al1 #pf2').addClass("red");
	}
 });
document.querySelector('#b1allon').addEventListener('click', function(e) {
	//alert('Bedroom 1 all on');
	sendStateToBT(5,100);
	$('#b1cl1 #pf1').removeClass("gray");
	$('#b1cl1 #pf1').addClass("green");
	$("#ps3").attr("value", 100);
	sleep(500);
	sendStateToBT(6,100);
	$('#b1al1 #pf2').removeClass("gray");
	$('#b1al1 #pf2').addClass("red");
 });
document.querySelector('#b1alloff').addEventListener('click', function(e) {
	//alert('Bedroom 1 all off');
	sendStateToBT(5,0);
	$('#b1cl1 #pf1').removeClass("green");
	$('#b1cl1 #pf1').addClass("gray");
	$("#ps3").attr("value", 0);
	sleep(500);
	sendStateToBT(6,0);
	$('#b1al1 #pf2').removeClass("red");
	$('#b1al1 #pf2').addClass("gray");
 });
document.querySelector('#b2cl1 #pf1').addEventListener('click', function(e) {
	//alert('Bedroom 2 Ceiling lights - On-Off');
	if($('#b2cl1 #pf1').hasClass("green")){
		sendStateToBT(7,0);
		$('#b2cl1 #pf1').removeClass("green");
		$('#b2cl1 #pf1').addClass("gray");
		$("#ps3").attr("value", "0");
	}
	else{
		sendStateToBT(7,100);
		$('#b2cl1 #pf1').removeClass("gray");
		$('#b2cl1 #pf1').addClass("green");
		$("#ps3").attr("value", "100");
	}
	//sendStateToBT(7,100);
 });
document.querySelector('#b2al1 #pf2').addEventListener('click', function(e) {
	//alert('Bedroom 2 Ambient LED - On-Off');
	if($('#b2al1 #pf2').hasClass("red")){
		sendStateToBT(8,0);
		$('#b2al1 #pf2').removeClass("red");
		$('#b2al1 #pf2').addClass("gray");
	}
	else{
		sendStateToBT(8,100);
		$('#b2al1 #pf2').removeClass("gray");
		$('#b2al1 #pf2').addClass("red");
	}
	//sendStateToBT(8,100);
 });
document.querySelector('#b2allon').addEventListener('click', function(e) {
	//alert('Bedroom 2 all on');
	sendStateToBT(7,100);
	$('#b2cl1 #pf1').removeClass("gray");
	$('#b2cl1 #pf1').addClass("green");
	$("#ps4").attr("value", 100);
	sleep(500);
	sendStateToBT(8,100);
	$('#b2al1 #pf2').removeClass("gray");
	$('#b2al1 #pf2').addClass("red");
 });
document.querySelector('#b2alloff').addEventListener('click', function(e) {
	//alert('Bedroom 2 all off');
	sendStateToBT(7,0);
	$('#b2cl1 #pf1').removeClass("green");
	$('#b2cl1 #pf1').addClass("gray");
	$("#ps4").attr("value", 0);
	sleep(500);
	sendStateToBT(8,0);
	$('#b2al1 #pf2').removeClass("red");
	$('#b2al1 #pf2').addClass("gray");
 });
}
$('#ps1').change(function() {
	var dimmingValue = parseInt($('#lrcl1 #sliderKnobInner').attr("value"));
	sendStateToBT(1,dimmingValue);
	if(dimmingValue>0){
		$('#lrcl1 #pf1').removeClass("gray");
		$('#lrcl1 #pf1').addClass("green");
	}
	else{
		$('#lrcl1 #pf1').removeClass("green");
		$('#lrcl1 #pf1').addClass("gray");
}

 });
 $('#ps2').change(function() {
	var dimmingValue = parseInt($('#kcl1 #sliderKnobInner').attr("value"));
	sendStateToBT(3,dimmingValue);
	if(dimmingValue>0){
		$('#kcl1 #pf1').removeClass("gray");
		$('#kcl1 #pf1').addClass("green");
	}
	else{
		$('#kcl1 #pf1').removeClass("green");
		$('#kcl1 #pf1').addClass("gray");
	}
 });
 $('#ps3').change(function() {
	var dimmingValue = parseInt($('#b1cl1 #sliderKnobInner').attr("value"));
	sendStateToBT(5,dimmingValue);
	if(dimmingValue>0){
		$('#b1cl1 #pf1').removeClass("gray");
		$('#b1cl1 #pf1').addClass("green");
	}
	else{
		$('#b1cl1 #pf1').removeClass("green");
		$('#b1cl1 #pf1').addClass("gray");
	}
 });
 $('#ps4').change(function() {
	var dimmingValue = parseInt($('#b2cl1 #sliderKnobInner').attr("value"));
	//sendStateToBT(7,dimmingValue);
	if(dimmingValue>0){
		$('#b2cl1 #pf1').removeClass("gray");
		$('#b2cl1 #pf1').addClass("green");
	}
	else{
		$('#b2cl1 #pf1').removeClass("green");
		$('#b2cl1 #pf1').addClass("gray");
	}
 });
$("#fav").click(function(){
	ControllerPlugin.setMood("setMood");
	//ControllerPlugin.saveState('update', 1, 0,0,1);
	//ControllerPlugin.reloadData("reload");
	//alert("111");
});
$("#star").click(function(){

	//alert("star");
	dimmer1Intensity = parseInt($('#lrcl1 #sliderKnobInner').attr("value"));
	if(dimmer1Intensity>0){
		one = '"1":{"state":"1","intensity":"'+dimmer1Intensity+'"}';
	}
	else{
		one = '"1":{"state":"0","intensity":"0"}';
	}
	//alert(one);
	dimmer2Intensity = 0;
	if($('#lral1 #pf2').hasClass("red")){
		dimmer2Intensity=100;
	}
	if(dimmer2Intensity>0)
		two = '"2":{"state":"1","intensity":"'+dimmer2Intensity+'"}';
	else
		two = '"2":{"state":"0","intensity":"0"}';
	//alert(two);

	dimmer3Intensity = parseInt($('#kcl1 #sliderKnobInner').attr("value"));
	if(dimmer3Intensity>0)
		three = '"3":{"state":"1","intensity":"'+dimmer3Intensity+'"}';
	else
		three = '"3":{"state":"0","intensity":"0"}';
	//alert(three);
	dimmer4Intensity = 0;
	if($('#kal1 #pf2').hasClass("red")){
		dimmer4Intensity=100;
	}
	if(dimmer4Intensity>0)
		four = '"4":{"state":"1","intensity":"'+dimmer4Intensity+'"}';
	else
		four = '"4":{"state":"0","intensity":"0"}';
	//alert(four);
	dimmer5Intensity = parseInt($('#b1cl1 #sliderKnobInner').attr("value"));
	if(dimmer5Intensity>0)
		five = '"5":{"state":"1","intensity":"'+dimmer5Intensity+'"}';
	else
		five = '"5":{"state":"0","intensity":"0"}';
	//alert(five);
	dimmer6Intensity = 0;
	if($('#b1al1 #pf2').hasClass("red")){
		dimmer6Intensity=100;
	}
	if(dimmer6Intensity>0)
		six = '"6":{"state":"1","intensity":"'+dimmer6Intensity+'"}';
	else
		six = '"6":{"state":"0","intensity":"0"}';
	//alert(six);
	count = '"count":"6"';
	moodJSON = '{'+one+','+two+','+three+','+four+','+five+','+six+','+count+'}';
	ControllerPlugin.saveMood("saveMood",moodJSON);
	//alert(moodJSON);
});
function sendStateToBT(dimmerId, value){
	var dataToSend = [123, dimmerId, value, value-dimmerId];
	sendDataToBT(dataToSend);
	var onOff = 0;
	if(value==0){
		onOff = 0;
	}
	else{
		onOff = 1;			
	}
	//alert("saving dimmerId - "+dimmerId+" - onOff - "+onOff+" - value - "+value);
	ControllerPlugin.saveState('update', dimmerId, onOff, value, 1);
}
function sendDataToBT(dataToSend){
	bluetoothSerial.write([dataToSend[0]], dataWritten, failedToWrite);
	sleep(30);
	bluetoothSerial.write([dataToSend[1]], dataWritten, failedToWrite);
	sleep(30);
	bluetoothSerial.write([dataToSend[2]], dataWritten, failedToWrite);
	sleep(30);
	bluetoothSerial.write([dataToSend[3]], dataWritten, failedToWrite);
}
function dataWritten(){

}
function failedToWrite(){

}
function someFunction(someString){
//alert(someString);
}
function sleep(milliseconds) {
	var start = new Date().getTime();
	for (var i = 0; i < 1e7; i++) {
		if ((new Date().getTime() - start) > milliseconds){
			break;
		}
	}
}
function readCurrentState(){
    	ControllerPlugin.reloadData("reload");
}
function displayMood(moodData){
	moodData = $.parseJSON(moodData);
	var a1 = ["#lrcl1 #pf1","#kcl1 #pf1","#b1cl1 #pf1","#b2cl1 #pf1"];
	var a2 = ["#lral1 #pf2","#kal1 #pf2","#b1al1 #pf2","#b2al1 #pf2"];
	var sliderIndex=1;
	$.each(moodData, function(idx, resultObj) {
		var bulbId = parseInt(resultObj.id);
		if(bulbId == 1 || bulbId == 3 || bulbId == 5 || bulbId == 7){
			var pf = a1[sliderIndex-1];
			var dimmingValue = parseInt(resultObj.intensity); 
			sendStateToBT(bulbId,dimmingValue);
			//alert(bulbId+" -- "+dimmingValue+" -- "+pf);
			if(dimmingValue>0){
				$(pf).removeClass("gray");
				$(pf).addClass("green");
			}
			else{
				$(pf).removeClass("green");
				$(pf).addClass("gray");
			}
			$("#ps"+sliderIndex++).attr("value", dimmingValue);
		}
		else if(bulbId == 2 || bulbId == 4 || bulbId == 6 || bulbId == 8){
			var pf = a2[(bulbId/2)-1];
			var dimmingValue = parseInt(resultObj.state)*100; 
			sendStateToBT(bulbId,dimmingValue);
			//alert(bulbId+" -- "+dimmingValue+" -- "+pf);
			if(dimmingValue>0){
				$(pf).removeClass("gray");
				$(pf).addClass("red");
			}
			else{
				$(pf).removeClass("red");
				$(pf).addClass("gray");
			}
		}		
		
		
	});
}
function sendCurrentStateToBackend(){
	//alert("hi");
    	var a1 = ["#lrcl1 #sliderKnobInner","#kcl1 #sliderKnobInner","#b1cl1 #sliderKnobInner","#b2cl1 #sliderKnobInner"];
		var a2 = ["#lral1 #pf2","#kal1 #pf2","#b1al1 #pf2","#b2al1 #pf2"];
		var sliderIndex=0;
		var ledIndex=0;
    	for(var i = 0; i<8; i++){
    		//alert("hi"+i);
    		if(i==0 || i==2 || i==4 || i==6){
    			//alert("hello"+i+" -- "+$(a1[i]).attr("value")+" -- "+$('#lrcl1 #sliderKnobInner').attr("value"));
    			var dimmingValue = parseInt($(a1[sliderIndex++]).attr("value"));
    			sendStateToBT(i+1,dimmingValue);
    		}
    		else if(i==1 || i==3 || i==5 || i==7){
    			var dimmingValue = 0;
				if($(a2[ledIndex++]).hasClass("red")){
					dimmingValue=100;
				}
    			sendStateToBT(i+1,dimmingValue);
    		}
    	}
}
</script>

</body>
</html>
